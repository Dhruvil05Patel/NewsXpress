# Frontend Unit Testing Report — NewsXpress

Date: 2025-11-27
Author: Automated test-run report (assistant)

## Summary
- Test runner: Vitest v4.x (project script: `npm run coverage`).
- Last full run: All tests passed (153 tests / 16 files) after recent fixes and additions.
- Coverage engine: v8 (Vitest coverage).
- Coverage snapshot (key highlights) included below.

## How to reproduce locally
From the workspace root run:

```powershell
cd NewsXpress\frontend
npm install   # (if dependencies missing)
npm run coverage
```

After the run, open the HTML coverage report at:

`NewsXpress/frontend/coverage/index.html`

## Test & Coverage Results (latest run)
- Tests: 153 passed, 0 failed.
- Test files: 16 passed, 0 failed.

Coverage (v8 summary):
- All files (project): Statements 86.16% | Branch 72.04% | Functions 85.18% | Lines 87.72%
- Notable files:
  - `components/Navbar.jsx`: Statements 72.05% | Lines 75% — uncovered lines: 173-193, 227, 289-290
  - `components/Profile.jsx`: Statements 75% | Lines 76.84% — uncovered lines: (approx) start-31, 136-141, 380-381, 395
  - `components/LanguageSelector.jsx`: Low statements coverage 56.52% — several branches and functions untested
  - Most other components are above ~90% statements coverage.

Full per-file breakdown is available in the HTML report generated by Vitest at `frontend/coverage/index.html`.

## Changes made while improving coverage
- Created and migrated sidebar tests to `src/test/Navbar.test.jsx`. Tests now cover:
  - Logo and categories rendering
  - Category navigation behavior (desktop & mobile)
  - Mobile sidebar open/close and overlay/close-button behavior
  - Search input focus/blur styling and controlled behavior
  - Guest vs logged-in search behavior (click-to-login and preventing search change)
  - Active-category styling detection
  - Mouse enter / leave inline style changes on the profile trigger
- Stabilized `src/test/Profile.test.jsx` tests by:
  - Targeting the desktop / settings instances explicitly when duplicate DOM nodes exist
  - Using real timers for debounce-based username checks and `waitFor` with generous timeouts
  - Mocking `api.updateProfile` and `api.checkUsernameAvailability` to exercise success/error paths
  - Adding tests for logout behavior (mocked `logoutUser`) and save failure handling
- Fixed brittle assertions (color strings normalized to JSDOM's computed rgb values) and duplicate-element queries (used `getAllBy*` and `within()` where relevant).
- Deleted obsolete `SideBar.test.jsx` and consolidated tests under `Navbar.test.jsx`.

## Remaining coverage gaps (recommended targets)
1. `components/Navbar.jsx` (lines 173-193, 227, 289-290)
   - These ranges include mobile overlay close transition branches and some branches around `isSidebarVisible`/`sidebarOpen` transitions and possibly alternative className branches. Tests that explicitly force mobile viewport and exercise `sidebarOpen`/`isSidebarVisible` transitions (including the `setTimeout` path) will close these gaps.

2. `components/Profile.jsx` (start areas & settings branches)
   - Add tests for:
     - The `account-deleted` event dispatch/listener (ensure the event handler runs and is removed on unmount).
     - `handleDeleteAccount` success flow for logged-in users (simulate `userProfile.id` present; test the `notify.warn` and `notify.success` calls and event dispatch).
     - The desktop aside `onClose` path and `Help & Support` navigation branch (mock `useNavigate` to assert navigation).
     - The `Logout` flow already has tests for calling `logoutUser` but consider asserting error handling path or location reload behavior in a way that doesn't redefine non-configurable properties.

3. `components/LanguageSelector.jsx` — low test coverage; consider adding tests for search filtering, item selection, and empty-state branches.

## Test hygiene & flakiness notes
- Several components render both mobile and desktop variants, producing duplicate DOM nodes (mobile + desktop). Tests avoid flakiness by using `getAllBy*` indexing and `within()` to scope queries.
- Some tests depend on debounce timers (Profile username availability). Prefer using `vi.useRealTimers()` in those tests and `await waitFor(..., { timeout: 5000 })` to avoid flakiness. For animation or transition timers, use `vi.advanceTimersByTime(...)` where appropriate and ensure timers are reset between tests.
- JSDOM computes color strings as `rgb(...)`; assertions on inline styles use computed rgb values (e.g. `rgb(239, 68, 68)`) rather than hex literals.

## Recommended next steps to push towards 100%
- Target `Navbar.jsx` and `Profile.jsx` coverage gaps first (high-impact, relatively small ranges).
- Add tests for `LanguageSelector.jsx` branches.
- If aiming for true 100% across the repository, plan for:
  - Small refactors that expose behavior (e.g., extract complex inline functions into named functions that can be unit-tested),
  - Adding test-only hooks/data-testid attributes for otherwise hard-to-reach branches,
  - Or accepting 100% for target files only (e.g., make `Navbar` and `Profile` reach 100%).

## Files created/modified during this effort
- Modified: `src/test/Navbar.test.jsx` — added/updated many tests
- Modified: `src/test/Profile.test.jsx` — stabilized debounce/username tests, added logout test
- Deleted: `src/test/SideBar.test.jsx` (deleted as part of migration)
- Created: this report file at `testing/Frontend_Unit_Test_Report.md`

## Contact / next actions
- If you want me to continue, I can:
  - Implement the targeted tests for `Navbar.jsx` and `Profile.jsx` uncovered ranges now (small, focused changes), and re-run coverage until we exceed a coverage target you set (e.g., 90%, 95%, or 100% for those files).
  - Create a checklist PR with the test additions so you can review diffs.

Would you like me to start with the `Navbar.jsx` uncovered lines, or `Profile.jsx` next? 

---
Generated report saved to: `testing/Frontend_Unit_Test_Report.md`
